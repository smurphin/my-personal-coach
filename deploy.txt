# Deployment commands - my-personal-coach

## Versioned deployment (recommended)

1. Bump VERSION file (e.g. 0.1.0 → 0.1.1)
2. Update CHANGELOG.md (move Unreleased → [X.Y.Z], add date)
3. Run deploy script:

   ./scripts/deploy.sh staging [vX.Y.Z]    # Staging first (test)
   ./scripts/deploy.sh prod [vX.Y.Z]       # Then prod
   ./scripts/deploy.sh beta [vX.Y.Z]       # All beta (mark, shane, dom)
   ./scripts/deploy.sh mark [vX.Y.Z]       # Single tenant (e.g. hotfix for Mark)
   ./scripts/deploy.sh shane [vX.Y.Z]      # Single tenant
   ./scripts/deploy.sh dom [vX.Y.Z]        # Single tenant
   ./scripts/deploy.sh all [vX.Y.Z]        # All repos

4. Trigger App Runner deployment (per environment):
   aws apprunner start-deployment --service-arn <ARN> --region eu-west-1

5. Verify: curl https://<your-domain>/version

## Manual deployment (versioned)

# ECR login
aws ecr get-login-password --region eu-west-1 | sudo docker login --username AWS --password-stdin 321490400104.dkr.ecr.eu-west-1.amazonaws.com

# Build with version (replace v1.0.0 with your version)
VERSION=v1.0.0
sudo docker build --build-arg VERSION=$VERSION -t 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:$VERSION -t 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:latest .
sudo docker push 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:$VERSION
sudo docker push 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:latest

# Repeat for other repos: my-personal-coach-app, mark-kaizencoach-app, shane-kaizencoach-app, dom-kaizencoach-app

## Legacy (unversioned, :latest only)

sudo docker build -t 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:latest .
sudo docker push 321490400104.dkr.ecr.eu-west-1.amazonaws.com/staging-kaizencoach-app:latest
