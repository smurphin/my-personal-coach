{% extends "base.html" %}

{% block title %}Chat Log{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-white">Coach Chat Log</h1>
    <p class="text-brand-light-gray mt-1">A complete history of your conversations with the AI coach.</p>
</div>

<!-- Chat Input Form (at top) -->
<div class="bg-brand-gray rounded-xl shadow-lg p-6 lg:p-8 mb-6">
    <h2 class="text-xl font-semibold text-brand-blue mb-4">Ask your coach</h2>
    <p class="text-sm text-brand-light-gray mb-4">
        Need to adjust your plan? Feeling tired? Have a question? Let your coach know.
    </p>
    <form action="{{ url_for('dashboard.chat') }}" method="post">
        <textarea name="user_message" rows="3" required class="w-full bg-brand-dark border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-brand-blue focus:border-brand-blue transition" placeholder="e.g., 'I had a really busy week and missed my long run. What should I do?'"></textarea>
        <div class="mt-4">
            <button type="submit" class="w-full sm:w-auto bg-brand-blue text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-brand-blue-hover transition-transform transform hover:scale-105 duration-300 ease-in-out">
                Send Message
            </button>
        </div>
    </form>
</div>

<!-- Chat History -->
<div class="bg-brand-gray rounded-xl shadow-lg p-6 lg:p-8">
    {% if chat_history %}
        <div class="space-y-6">
            {% for message in chat_history | reverse %}
                {% if message.role == 'user' %}
                    <div class="text-right">
                        <p class="text-xs text-gray-400 mb-1">You said:</p>
                        <p class="inline-block bg-brand-blue text-white rounded-lg px-4 py-2 max-w-xl">{{ message.content }}</p>
                    </div>
                {% elif message.role == 'model' %}
                    <div>
                        <p class="text-xs text-gray-400 mb-1">Coach replied:</p>
                        <div class="prose prose-invert max-w-none prose-p:text-lg">
                            {{ message.content | safe }}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <p class="text-brand-light-gray">You have no chat history yet. Start a conversation above! üëÜ</p>
    {% endif %}
</div>

<div class="mt-8 flex justify-between items-center">
    <a href="{{ url_for('dashboard.dashboard') }}" class="text-brand-blue hover:underline">‚Üê Back to Dashboard</a>
    
    {% if chat_history %}
    <form action="{{ url_for('dashboard.clear_chat') }}" method="post" onsubmit="return confirm('Are you sure you want to permanently delete your entire chat history?');">
        <button type="submit" class="text-sm text-gray-400 hover:text-white hover:underline">
            Delete Chat History
        </button>
    </form>
    {% endif %}
</div>

{% endblock %}