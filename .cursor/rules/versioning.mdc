---
description: Versioning and changelog workflow for releases
alwaysApply: true
---

# Versioning & Changelog

## MANDATORY: Before any file edits

**You MUST do this before using any tool that modifies files** (e.g. `write`, `search_replace`, `ApplyPatch`). No exceptions.

1. **Check current branch**: Run `git branch --show-current` (or equivalent). If you have not yet done this in this task, do it now before editing.
2. **If the current branch is `main`**: Create or switch to a feature/patch branch (e.g. `fix/issue-name`, `docs/update-readme`), then perform all edits only on that branch. Do not edit files on `main`.
3. **If the change is deployable** (code, config, or docs that will be released): Before or with your first edit, bump **VERSION** (repo root) per Major.Feature.Patch and add an entry under **`[Unreleased]`** in **CHANGELOG.md** (repo root). Changelog sections: Added, Changed, Fixed, Removed, Security.

Treat `main` as deployed state. Do not commit or push unless the user explicitly asks.

---

When making changes that will be deployed:

1. **VERSION** (repo root): Bump per Major.Feature.Patch (v0 = beta, v1 = Strava onboarded)
2. **CHANGELOG.md** (repo root): Add entries under `[Unreleased]` as you work. Follow [Keep a Changelog](https://keepachangelog.com/en/1.1.0/): section order Added, Changed, Fixed, etc.; keep each bullet as a short, single sentence about the user-visible change (no internal process notes, no long multi-clause paragraphs).

**Before considering deployable work complete:** Verify you have (1) bumped **VERSION** and (2) added all relevant entries under **`[Unreleased]`** in **CHANGELOG.md**. If you did not do this at the start, do it before finishing the task.

**At commit / push (release finalization):** When the user is ready to commit or push, move **`[Unreleased]`** content into a new release section **`## [X.Y.Z] - YYYY-MM-DD`** (ISO date), where X.Y.Z matches **VERSION**. Leave **`[Unreleased]`** empty. Only include user-facing behavioural changes here (e.g. feedback extraction behaviour, prompt output, APIs, UI), not internal planning documents.

**Do not touch:** Terraform/infra (owner maintains manually). See `docs/versioning.md` for full workflow.

## Environments & deployment

- **App Runner services**: staging, prod, and beta (plus single-tenant variants like `mark`, `shane`, `dom`) run in AWS App Runner.
- **Deployment script**: Use `./scripts/deploy.sh <env> vX.Y.Z` as documented in `deploy.txt` (staging first, then prod/beta).
- **Health check**: Verify the deployed version with `GET /version` on the target environment.
