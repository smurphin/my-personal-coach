2. Deployment & Update Guide
This guide outlines the process for deploying the application or pushing an update from the single repository.

Prerequisites:

AWS CLI, Terraform CLI, and Docker installed.

The my-personal-coach repository cloned to your local machine.

Step 1: Authenticate with AWS ECR
Your Docker login token for AWS expires every 12 hours. Before pushing an image, you must re-authenticate from your terminal.

Bash

aws ecr get-login-password --region eu-west-1 | sudo docker login --username AWS --password-stdin 321490400104.dkr.ecr.eu-west-1.amazonaws.com
Step 2: Build and Push the Docker Image
From the root of the my-personal-coach repository, build the image, then push it.

Bash

# Build the image, tagging it for ECR
sudo docker build -t 321490400104.dkr.ecr.eu-west-1.amazonaws.com/my-personal-coach-app:latest .

# Push the newly built image to ECR
sudo docker push 321490400104.dkr.ecr.eu-west-1.amazonaws.com/my-personal-coach-app:latest
Step 3: Deploy the Infrastructure (First Time Only)
If this is the first deployment, navigate to the infra/ directory and run the Terraform commands.

```Bash

# Change to the infrastructure directory
cd infra

# Initialize Terraform
terraform init

# Plan the deployment (using the prod backend config)
terraform plan -backend-config=environments/prod/prod.tfbackend

# Apply the changes to create the infrastructure
terraform apply -backend-config=environments/prod/prod.tfbackend
```
After the first deployment, you will need to perform a one-time setup at your domain registrar (Namecheap) to point the domain's nameservers to the ones created by the AWS Route 53 hosted zone.

Step 4: Trigger the Application Update
AWS App Runner does not automatically deploy a new image just because the :latest tag has been updated in ECR. You must trigger the deployment manually.

Navigate to the AWS App Runner console.

Select the my-personal-coach-service.

In the top-right corner, click the "Deploy" button.
